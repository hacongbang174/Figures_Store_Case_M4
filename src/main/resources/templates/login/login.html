<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SignIn&SignUp</title>
    <link rel="stylesheet" href="/assets/bootstrap/v5.3.0/css/bootstrap.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<!--    <link rel="stylesheet" href="/assets/home/slider/owl.carousel.min.css">-->
<!--    <link rel="stylesheet" href="/assets/home/slider/owl.theme.default.min.css">-->
    <link rel="stylesheet" href="/assets/sweetalert2/sweetalert2.min.css">
    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="stylesheet" type="text/css" href="/assets/login/login.css"/>
    <style>
        label.error {
            display: list-item;
        }

        input.error {
            border: solid 1px red;
        }
        .error-message {
            color: red;
            width: 500px;
            float: left;
            padding-left: 60px;
        }
    </style>
</head>

<body>

<div class="container-fluid">
    <div class="row">
<!--        <th:block th:replace="webshop/header :: header"></th:block>-->
    </div>
    <div class="row">
        <div class="container">

            <div class="forms-container">
                <div class="signin-signup">
                    <form method="post" class="sign-in-form" id="frmLogin">
                        <h2 class="title">Sign In</h2>
                        <div class="error-message"></div>

                        <div class="input-field">
                            <i class="fas fa-user"></i>
                            <input type="text" id="usernameLog" placeholder="Username"/>
                        </div>
                        <div class="input-field">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="passwordLog" placeholder="Password"/>
                        </div>
                        <div class="checkbox icheck">
                            <label>
                                <input type="checkbox" class="" value="remember"><span> Remember login</span>
                            </label>
                        </div>
                        <input type="button" id="btnLogin" value="Login" class="btn solid"/>

                        <p class="social-text">Or Sign in with social platforms</p>
                        <div class="social-media">
                            <a href="#" class="social-icon">
                                <i class="fab fa-facebook-f"></i>
                            </a>
                            <a href="#" class="social-icon">
                                <i class="fab fa-twitter"></i>
                            </a>
                            <a href="#" class="social-icon">
                                <i class="fab fa-google"></i>
                            </a>
                            <a href="#" class="social-icon">
                                <i class="fab fa-linkedin-in"></i>
                            </a>
                        </div>
                    </form>


                    <form id="frmRegister" class="sign-up-form">
                        <h2 class="title">Sign Up</h2>

                        <div class="error-message"></div>

                        <div class="input-field">
                            <i class="fas fa-user"></i>
                            <input type="text" id="fullNameReg" placeholder="Full Name"/>

                        </div>
                        <div class="input-field">
                            <i class="fas fa-user"></i>
                            <input type="text" id="usernameReg" placeholder="Username"/>
                        </div>
                        <div class="input-field">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="passwordReg" placeholder="Password"/>
                        </div>
                        <div class="input-field">
                            <i class="fas fa-envelope"></i>
                            <input type="email" id="emailReg" placeholder="Email"/>
                        </div>
                        <div class="input-field">
                            <i class="fas fa-phone"></i>
                            <input type="tel" id="phoneReg" placeholder="Phone" />
                        </div>
                        <button type="button" id="btnRegister" class="btn solid">Sign Up</button>

                        <p class="social-text">Or Sign up with social platforms</p>
                        <div class="social-media">
                            <a href="#" class="social-icon">
                                <i class="fab fa-facebook-f"></i>
                            </a>
                            <a href="#" class="social-icon">
                                <i class="fab fa-twitter"></i>
                            </a>
                            <a href="#" class="social-icon">
                                <i class="fab fa-google"></i>
                            </a>
                            <a href="#" class="social-icon">
                                <i class="fab fa-linkedin-in"></i>
                            </a>
                        </div>
                    </form>
                </div>
            </div>

            <div class="panels-container">

                <div class="panel left-panel">
                    <div class="content">
                        <h3>New here?</h3>
                        <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Optio minus natus est.</p>
                        <button class="btn transparent" id="sign-up-btn">Sign Up</button>
                    </div>
                    <img src="/assets/login/img/log.svg" class="image" alt="">
                </div>

                <div class="panel right-panel">
                    <div class="content">
                        <h3>One of us?</h3>
                        <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Optio minus natus est.</p>
                        <button class="btn transparent" id="sign-in-btn">Sign In</button>
                    </div>
                    <img src="/assets/login/img/register.svg" class="image" alt="">
                </div>
            </div>


        </div>
    </div>
    <div class="row">
<!--        <th:block th:replace="webshop/layout/footer"></th:block>-->
    </div>

</div>



<script src="/assets/jquery/jquery-3.7.0.min.js"></script>
<!--<script src="/assets/jquery/jquery.easing.min.js"></script>-->
<script src="/assets/jquery/jquery.validate.js"></script>
<script src="/assets/bootstrap/v5.3.0/js/bootstrap.min.js"></script>
<!--<script src="/assets/slider/masterslider.min.js"></script>-->
<!--<script src="/assets/slider/owl.carousel.min.js"></script>-->
<script src="/assets/js/notify-0.4.1.min.js"></script>
<script src="/assets/sweetalert2/sweetalert2.all.min.js"></script>
<script src="/assets/login/login.js"></script>
<script src="/assets/js/appBase.js"></script>
<script>
    const page = {
        urls: {
            login: AppBase.API_LOGIN,
            register: AppBase.API_REGISTER
        },
        elements: {},
        commands: {},
        dialogs: {
            elements: {},
            commands: {}
        },
    }
    page.elements.frmLogin = $("#frmLogin");
    page.elements.usnLogin = $("#usernameLog");
    page.elements.pwdLogin = $("#passwordLog");

    page.elements.btnLogin = $("#btnLogin");
    page.elements.errorLogin = $('#frmLogin .error-message')

    page.elements.frmRegister = $("#frmRegister");
    page.elements.fullNameReg = $("#fullNameReg");
    page.elements.usernameReg = $("#usernameReg");
    page.elements.passwordReg = $("#passwordReg");
    page.elements.emailReg = $("#emailReg");
    page.elements.phoneReg = $("#phoneReg");

    page.elements.btnRegister = $("#btnRegister");

    page.elements.errorRegister = $('#frmRegister .error-message')



    page.commands.login = () => {
        let user = {
            username: page.elements.usnLogin.val(),
            password: page.elements.pwdLogin.val()
        }

        $.ajax({
            type: "POST",
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            url: page.urls.login,
            data: JSON.stringify(user)
        }).done((resp) => {
            console.log(resp)

            AppBase.Notify.showSuccessAlert("Logged in successfully !");
            if (resp.name === 'admin') {
                setTimeout(function () {
                    window.location.href = "/dashboard";
                }, 1000);
            }else {
                setTimeout(function () {
                    window.location.href = "/shop";
                }, 1000);
            }

        }).fail(function (jqXHR) {
            page.elements.frmLogin[0].reset();

            if (jqXHR.responseJSON) {
                if (jqXHR.responseJSON.message) {
                    AppBase.Notify.showErrorAlert(jqXHR.responseJSON.message);
                }
                else {
                    let str = '<ul>';
                    $.each(jqXHR.responseJSON, (k, v) => {
                        str += `<li>${v}</li>`;
                    })
                    str += '</ul>'
                    page.elements.errorLogin.append(str);
                    page.elements.errorLogin.removeClass('hide').addClass('show');
                }
            }
            else {
                AppBase.Notify.showErrorAlert("The email or password is incorrect, please check the information again");
            }
        });
    }

    page.commands.register = () => {
        let user = {
            fullName : page.elements.fullNameReg.val(),
            username : page.elements.usernameReg.val(),
            password : page.elements.passwordReg.val(),
            email : page.elements.emailReg.val(),
            phone : page.elements.phoneReg.val(),
            role : {
                id : 4,
                code: 'CUSTOMER'
            }
        }

        $.ajax({
            type: "POST",
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            url: page.urls.register,
            data: JSON.stringify(user)
        }).done((resp) => {

            AppBase.Notify.showSuccessAlert("Successful account registration !");
            alert("Register success");

            setTimeout(function () {

                page.elements.usnLogin.val(page.elements.usernameReg.val());
                page.elements.pwdLogin.val(page.elements.passwordReg.val());
                container.classList.remove("sign-up-mode");
                // page.commands.switchLoginForm();
            }, 1000);
            page.elements.errorRegister.empty();
        }).fail(function (jqXHR) {
            page.elements.frmRegister[0].reset();

            if (jqXHR.responseJSON) {
                if (jqXHR.responseJSON.message) {
                    AppBase.Notify.showErrorAlert(jqXHR.responseJSON.message);
                }
                else {
                    let str = '<ul>';
                    $.each(jqXHR.responseJSON, (k, v) => {
                        str += `<li>${v}</li>`;
                    })
                    str += '</ul>'
                    page.elements.errorRegister.append(str);
                    page.elements.errorRegister.removeClass('hide').addClass('show');
                }
            }
            else {
                AppBase.Notify.showErrorAlert("Something went wrong, please try again");
            }
        });
    }
    page.elements.frmLogin.validate({
        rules: {

            username: {
                required: true
            },
            password: {
                required: true
            }
        },
        messages: {
            username: {
                required: "Please enter your username."
            },
            password: {
                required: "Please enter your password."
            }
        },
        errorLabelContainer: "#frmLogin .error-message",
        errorPlacement: function (error, element) {
            error.appendTo("#frmLogin .error-message");
        },
        showErrors: function (errorMap, errorList) {
            if (this.numberOfInvalids() > 0) {
                $("#frmLogin .error-message").removeClass("hide").addClass("show");
            } else {
                $("#frmLogin .error-message").removeClass("show").addClass("hide").empty();
                $("#frmLogin input.error").removeClass("error");
            }
            this.defaultShowErrors();
        },
        submitHandler: function () {
            page.commands.login();
        }
    })

    page.elements.frmRegister.validate({
        rules: {
            fullNameReg: {
                required: true,
                minlength: 5,
                maxlength: 50
            },
            usernameReg: {
                required: true,
                minlength: 5,
                maxlength: 30
            },
            passwordReg: {
                required: true,
                minlength: 6,
                maxlength: 30
            },
            emailReg: {
                required: true,
                email: true,
                maxlength: 100
            },
            phoneReg: {
                required: true,
                number:true,
                minlength: 10,
                maxlength: 12,
            },
        },
        messages: {
            fullNameReg: {
                required: "Please enter your full name.",
                minlength: "Full Name must be at least 5 characters long.",
                maxlength: "Full Name cannot exceed 50 characters."
            },
            usernameReg: {
                required: "Please enter your username.",
                minlength: "Username must be at least 5 characters long.",
                maxlength: "Username cannot exceed 30 characters."
            },
            passwordReg: {
                required: "Please enter your password.",
                minlength: "Password must be at least 6 characters long.",
                maxlength: "Password cannot exceed 30 characters."
            },
            emailReg: {
                required: "Please enter your email address.",
                email: "Please enter a valid email address.",
                maxlength: "Email cannot exceed 100 characters."
            },
            phoneReg: {
                required: "Please enter your phone number.",
                number: "Please enter a valid phone.",
                minlength: "Your phone number must be at least 10 digits long.",
                maxlength: "Your phone number must not exceed 12 digits.",
            }
        },
        errorLabelContainer: "#frmRegister .error-message",
        errorPlacement: function (error, element) {
            error.appendTo("#frmRegister .error-message");
        },
        showErrors: function (errorMap, errorList) {
            if (this.numberOfInvalids() > 0) {
                $("#frmRegister .error-message").removeClass("hide").addClass("show");
            } else {
                $("#frmRegister .error-message").removeClass("show").addClass("hide").empty();
                $("#frmRegister input.error").removeClass("error");
            }
            this.defaultShowErrors();
        },
        submitHandler: function () {
            page.commands.register();
        }
    })

    page.initializeControlEvent = () => {

        page.elements.btnLogin.on("click", function () {
            page.elements.frmLogin.trigger('submit');
            // page.commands.login();
        });
        page.elements.btnRegister.on("click", function () {
            page.elements.frmRegister.trigger('submit');
            // page.commands.register();
        });
    }

    $(() => {
        page.initializeControlEvent();
    });

</script>
</body>

</html>